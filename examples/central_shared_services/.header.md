# AWS Hub and Spoke Architecture with AWS Transit Gateway - Example: Central Shared Services 

This example centralizes VPC endpoints for AWS Systems Manager (so the instances can be accessed using Session Manager), with a central Shared Services VPC. The following resources are built:

- Built by the **Hub and Spoke module**:
  - AWS Transit Gateway Route Tables: 1 Inspection, 3 Spokes (production, development, and testing).
  - Transit Gateway routes.
  - Shared Services VPC.
- Built outside the module:
  - AWS Transit Gateway.
  - 3 VPCs: 1 production, 1 development, and 1 testing.
  - EC2 instances in each Spoke VPC.
  - IAM role used for the EC2 instances to access AWS Systems Manager.
  - SSM VPC endpoints in the Shared Services VPC, and Private Hosted Zones associated to the Spoke VPCs.

If you simply want to review the infrastructure without any workloads, remove/comment the last four modules in the *main.tf* file - remember to also remove/comment the outputs.

## Deployment instructions

* First, you need to deploy the AWS Transit Gateway. When creating the VPCs (both Spoke and Central ones), Terraform needs the resource created beforehand - `terraform apply -target="module.hub-and-spoke.aws_ec2_transit_gateway.tgw" -target="aws_ec2_managed_prefix_list.network_prefix_list"`
* Once the resources are created, you need to create the Spoke VPCs. When creating the **Hub and Spoke module**, Terraform needs the VPC attachments created beforehand - `terraform apply -target="module.spoke_vpcs"`.
* Now, you can finish and apply the rest of the resources - `terraform apply`.
* Once you finish your testing remember to delete the resources to avoid having unexpected charges - `terraform destroy`.